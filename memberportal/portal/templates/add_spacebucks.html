{% extends 'base.html' %}

{% block title %}Add Spacebucks{% endblock %}
{% load staticfiles %}
{% block content %}
    <div class="admin-container center row small-row">
        <h3 class="header center text">Add funds to Spacebucks</h3>
        {% if success %}
            <p class="light-green-text">{{ message }}</p>
        {% elif success is False %}
            <p class="light-green-text">There was an error saving your payment details. {{ message }}</p>
        {% endif %}

        <p class="larger-text">Your current spacebucks balance is ${{ user.profile.spacebucks_balance|floatformat:2 }}</p>

        <h5 class="header center text">Card Details</h5>
        {% if not user.profile.stripe_card_last_digits == "" %}
            <div class="row">
                <div class="col s12 m6">
                    <p><b>Card Number:</b> **** **** **** {{ user.profile.stripe_card_last_digits }} </p>
                </div>
                <div class="col s12 m6">
                    <p><b>Expiry Date:</b> {{ user.profile.stripe_card_expiry }}</p>
                </div>
            </div>
            <div class="row">
                <a href="{% url 'delete_spacebucks_payment_info' %}" class="btn waves-effect waves-light">Remove
                    Card</a>
                <br>
                <br>
            </div>

            <div class="row">
                <h5 class="header center text">Add Funds</h5>
                <p>Click a button below to add spacebucks. This will immediately charge your card with the specified
                    amount.</p>

                <div class="col s12 m3">
                    <form method="POST" action="{% url 'add_spacebucks' amount=5 %}">
                        {% csrf_token %}
                        <button class="btn waves-effect waves-light" type="submit" name="action">$5</button>
                    </form>
                </div>
                <div class="col s12 m3">
                    <form method="POST" action="{% url 'add_spacebucks' amount=10 %}">
                        {% csrf_token %}
                        <button class="btn waves-effect waves-light" type="submit" name="action">$10</button>
                    </form>
                </div>
                <div class="col s12 m3">
                    <form method="POST" action="{% url 'add_spacebucks' amount=20 %}">
                        {% csrf_token %}
                        <button class="btn waves-effect waves-light" type="submit" name="action">$20</button>
                    </form>
                </div>
                <div class="col s12 m3">
                    <form method="POST" action="{% url 'add_spacebucks' amount=50 %}">
                        {% csrf_token %}
                        <button class="btn waves-effect waves-light" type="submit" name="action">$30</button>
                    </form>
                </div>
            </div>

        {% else %}
            <p>We currently have no card details on record. Please add one below. The process of adding a card will not
                charge any money to it.</p>
            <form action="{% url 'add_spacebucks_payment_info' %}" method="POST">
                <script
                        src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                        data-key="pk_test_RMZy6yDuPpdxa0pCQsBkwbJC"
                        data-name="HSBNE Member Portal"
                        data-description="Link a card to your HSBNE account."
                        data-image="{% static '/img/logo.png' %}"
                        data-locale="auto"
                        data-zip-code="true"
                        data-currency="aud">
                </script>
            </form>
        {% endif %}
    </div>
{% endblock %}

{% block scripts %}
    <script src="https://js.stripe.com/v3/"></script>
{% endblock %}
